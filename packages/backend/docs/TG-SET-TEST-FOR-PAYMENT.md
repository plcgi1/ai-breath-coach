Для тестирования платежей (включая Telegram Stars) в Telegram не существует отдельного сайта-песочницы, как у Stripe. Вместо этого используется **Тестовая среда (Test Environment)** самого Telegram.

Вот пошаговая инструкция, как настроить и использовать «песочницу» для отладки твоего бота.

---

### 1. Переход в Тестовую среду (DC)

Тестовая среда Telegram полностью изолирована от основной. Тестовые боты не видят «живых» пользователей, и наоборот.

* **Для Desktop:** Нажми 10 раз на иконку настроек (Settings), чтобы открыть скрытое меню (Debug), и выбери **"Switch to Test Server"**.
* **Для Android:** Настройки -> прокрути вниз до версии -> зажми и удерживай 2 раза -> в меню выбери **"Switch Backend"**.
* **Для iOS:** 10 раз нажми на иконку настроек -> **"Accounts"** -> **"Login to another account"** -> выбери тестовый регион.

> **Важно:** Тебе нужно будет создать новый аккаунт в тестовой среде (на тот же номер телефона придет СМС, но код появится в твоем «основном» приложении Telegram).

---

### 2. Создание тестового бота

В тестовой среде тоже есть свой `@BotFather`.

1. Найди его в поиске тестового сервера.
2. Создай бота и получи токен. Этот токен будет работать **только** с URL `https://api.telegram.org/bot<token>/...` при условии, что сервер понимает, что это тест, или ты используешь локальный `telegram-bot-api` сервер в режиме `--test`.

---

### 3. Настройка платежей в @BotFather

Даже для тестовых платежей нужно «подключить» провайдера (для Stars это формальность):

1. Напиши `/mybots` -> выбери бота -> **Bot Settings** -> **Payments**.
2. Выбери провайдера (для звезд это **Telegram Stars**).
3. Для обычных валют выбери любого провайдера (например, Stripe или Sberbank) и нажми **"Connect <Provider> Test"**. Ты получишь тестовый токен провайдера (начинается с `TEST:`).

---

### 4. Тестирование процесса

Теперь, когда бот в тестовом режиме, API будет вести себя иначе:

* **Stars:** При вызове `createInvoiceLink` и попытке оплаты, Telegram не будет списывать реальные звезды. Он покажет окно оплаты с пометкой **"Test"**.
* **Карты:** Если ты тестируешь фиатные деньги, используй специальные тестовые номера карт.
* *Пример:* `4242 4242 4242 4242`, срок действия в будущем, любой CVC.



### 5. Как понять, что платеж тестовый (Код)

В твоем NestJS приложении при получении вебхука `successful_payment` или `pre_checkout_query` будет поле `shipping_option_id` или другие признаки, но главное — в самом начале пути ты работаешь с тестовым токеном бота.

В объекте `SuccessfulPayment` поле **`total_amount`** будет приходить в минимальных единицах валюты (для XTR это просто количество звезд), но реальных денег в системе Fragment ты не увидишь.

---

### Резюме чек-листа:

1. Зайти в тестовый аккаунт Telegram.
2. Создать бота через тестового `@BotFather`.
3. В коде использовать токен этого тестового бота.
4. Вызывать `createInvoiceLink` как обычно — Telegram сам поймет, что это тест, так как бот зарегистрирован на тестовом сервере.

**Хочешь, чтобы я показал, как в коде NestJS автоматически переключать Bot Token между локальной разработкой (тест) и продакшеном?**